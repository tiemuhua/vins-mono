From 0839651bbfde6fe234d686c1a5a9eff3b6ca94ad Mon Sep 17 00:00:00 2001
From: tiemuhuaguo <tiemuhuaguo@tencent.com>
Date: Fri, 23 Jun 2023 20:59:02 +0800
Subject: [PATCH] build

---
 .gitignore      |  1 +
 CMakeLists.txt  |  8 +++++++-
 build.py        | 22 ++++++++++++++++++++++
 build_mac_m1.sh | 11 +++++++++++
 4 files changed, 41 insertions(+), 1 deletion(-)
 create mode 100644 build.py
 create mode 100755 build_mac_m1.sh

diff --git a/.gitignore b/.gitignore
index 2678271..4b094a1 100644
--- a/.gitignore
+++ b/.gitignore
@@ -1,3 +1,4 @@
 *.orig
 /build*/
 bazel-*
+/install*/
\ No newline at end of file
diff --git a/CMakeLists.txt b/CMakeLists.txt
index f5c1e55..e77dcc5 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -5,6 +5,7 @@ project (glog
   HOMEPAGE_URL https://github.com/google/glog
   LANGUAGES CXX
 )
+set(CMAKE_CXX_STANDARD 14)
 
 set (CPACK_PACKAGE_NAME glog)
 set (CPACK_PACKAGE_DESCRIPTION_SUMMARY "Google logging library")
@@ -81,7 +82,12 @@ if (WITH_GMOCK AND TARGET GTest::gmock)
 endif (WITH_GMOCK AND TARGET GTest::gmock)
 
 if (WITH_GFLAGS)
-  find_package (gflags 2.2.2)
+  message("GFLAG_PATH", ${GFLAG_PATH})
+  find_package (
+    gflags 2.2.2
+    PATHS ${GFLAG_PATH}
+    NO_DEFAULT_PATH
+  )
 
   if (gflags_FOUND)
     set (HAVE_LIB_GFLAGS 1)
diff --git a/build.py b/build.py
new file mode 100644
index 0000000..d812915
--- /dev/null
+++ b/build.py
@@ -0,0 +1,22 @@
+import os
+import subprocess
+import platform
+
+PROJECT_PATH = os.path.split(os.path.realpath(__file__))[0] + '/'
+
+def call_shell(cmd:str)->int:
+    return subprocess.run(cmd.split(" "))
+
+if __name__ == '__main__':
+    BUILD_PATH:str = PROJECT_PATH + "build_" + platform.platform() + "/"
+    INSTALL_PATH:str = PROJECT_PATH + "install_" + platform.platform() + "/"
+    if not os.path.exists(BUILD_PATH):
+        os.makedirs(BUILD_PATH)
+    if not os.path.exists(INSTALL_PATH):
+        os.makedirs(INSTALL_PATH)
+    os.chdir(BUILD_PATH)
+    CMAKE_CMD:str = "cmake .. " + "-DCMAKE_INSTALL_PREFIX=" + INSTALL_PATH
+    call_shell(CMAKE_CMD)
+    call_shell("make -j$nproc")
+    call_shell("make install")
+    os.chdir("..")
diff --git a/build_mac_m1.sh b/build_mac_m1.sh
new file mode 100755
index 0000000..b1b1e12
--- /dev/null
+++ b/build_mac_m1.sh
@@ -0,0 +1,11 @@
+mkdir build_mac_m1_dir
+cd build_mac_m1_dir
+cmake .. \
+      -DCMAKE_BUILD_WITH_INSTALL_RPATH=ON \
+      -DCMAKE_BUILD_TYPE=Release \
+      -DBUILD_TESTING=OFF \
+      -DGFLAG_PATH=~/3rd/gflags/install_mac_m1_dir \
+      -DCMAKE_INSTALL_PREFIX=~/3rd/glog/install_mac_m1_dir
+
+make -j10
+make install
\ No newline at end of file
-- 
2.37.1 (Apple Git-137.1)

